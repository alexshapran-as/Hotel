<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hotel Admin Page</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.62/pdfmake.min.js" integrity="sha256-wHsYlzQ9EnjIdWOKOlQcOIw4imM+CDwRJ6NhkvJ96iY=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js" integrity="sha256-c3RzsUWg+y2XljunEQS0LqWdQ04X1D3j22fd/8JCAKw=" crossorigin="anonymous"></script>

    <script src="/js/jquery-3.1.1.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/css/bootstrap-grid.css">
    <link rel="stylesheet" href="/css/jumbotron-narrow.css">

    <link rel="stylesheet" href="/css/daterangepicker.css">

    <style>
        @font-face {
            font-family: 'Dosis', sans;
            font-style: normal;
            font-weight: normal;
        }

        body {
            background-image: url(/images/backgroung.jpg);
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }

        .modal-body {
            overflow: scroll;
            width: 100%;
            height: 100%;
            padding: 10px;
        }

        .container {
            display: flex;
            justify-content: space-around;
        }

        .beautyButton {
            background: white;
            display:block;
            border:1px solid black;
            font-family: 'Dosis', sans;
            font-weight: normal;
            color: black;
            text-transform:uppercase;
            text-decoration:none;
            text-align:center;
            opacity:.8;
            letter-spacing: 1px;
            -webkit-transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750);
            -moz-transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750);
            -o-transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750);
            transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750); /* linear */
        }

        .beautyButton:hover {
            background: black;
            border:1px solid white;
            color: white;
            opacity:1;
            letter-spacing: 4px;
            -webkit-transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750);
            -moz-transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750);
            -o-transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750);
            transition: all 300ms cubic-bezier(0.250, 0.250, 0.750, 0.750); /* linear */
        }

        .deleteEmployee {
            background: white;
            display:block;
            border:1px solid black;
            font-family: 'Dosis', sans;
            font-weight: normal;
            color: black;
            text-transform:uppercase;
            text-decoration:none;
            text-align:center;
        }

        .deleteEmployee:hover {
            background: black;
            border:1px solid white;
            color: white;
        }

        .openReserveDialog {
            background: white;
            display:block;
            border:1px solid black;
            font-family: 'Dosis', sans;
            font-weight: normal;
            color: black;
            text-transform:uppercase;
            text-decoration:none;
            text-align:center;
        }

        .openReserveDialog:hover {
            background: black;
            border:1px solid white;
            color: white;
        }

        .form-control {
            background: white;
            display:block;
            border:1px solid black;
            font-family: 'Dosis', sans;
            font-weight: normal;
            color: black;
            text-decoration:none;
        }
    </style>
</head>
<body>
<div id="mainDiv" class="container" style="font-family: 'Dosis', sans; text-transform:uppercase; min-width: 1000px">
    <div class='modal fade' id='employeesModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Сотрудники</h1>
                </div>
                <div class='modal-body'>
                    <table class="table" id="tableForEmployees">
                        <thead>
                        <tr>
                            <th>Username</th>
                            <th>Фамилия</th>
                            <th>Имя</th>
                            <th>Отчество</th>
                            <th>Дата рождения</th>
                            <th>Серия и номер паспорта</th>
                            <th>Адрес</th>
                            <th>Зарплата</th>
                            <th>Действие</th>
                        </tr>
                        </thead>
                        <tbody id="tableForEmployeesBody">
                        </tbody>
                    </table>
                </div>
                <div class='modal-footer'>
                    <button id='addEmployee' type='submit' class='beautyButton'
                            style='cursor: pointer;margin-left: 5px;'>Добавить сотрудника
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='addEmployeeModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Добавление Сотрудника</h1>
                </div>
                <div class='modal-body'>
                    <form id="addEmployeeForm" action="/hotel/admin/add_employee" method="post"
                          enctype="multipart/form-data" style="font-size: 16px;">
                        <label for="userName" style="font-weight: normal">Username :
                            <input id="userName" name="userName" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="password" style="font-weight: normal">Password :
                            <input id="password" name="password" type="password" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="roles" style="font-weight: normal">Должность :
                            <input id="roles" name="roles" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="lastName" style="font-weight: normal">Фамилия :
                            <input id="lastName" name="lastName" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="firstName" style="font-weight: normal">Имя :
                            <input id="firstName" name="firstName" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="surName" style="font-weight: normal">Отчество :
                            <input id="surName" name="surName" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="birthDate" style="font-weight: normal">Дата рождения :
                            <input id="birthDate" name="birthDate" type="date" value="1970-01-01" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="seriesNumberPassport" style="font-weight: normal">Серия и номер паспорта :
                            <input id="seriesNumberPassport" name="seriesNumberPassport" type="text" value=""
                                   class="form-control" style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="address" style="font-weight: normal">Адрес :
                            <input id="address" name="address" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                        <label for="salary" style="font-weight: normal">Оклад :
                            <input id="salary" name="salary" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <br>
                    </form>
                </div>
                <div class='modal-footer'>
                    <button id='addEmployeeInModal' type="submit" class="beautyButton"
                            style='cursor: pointer;margin-left: 5px;'>Добавить
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='roomsModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Номера</h1>
                </div>
                <div class='modal-body'>
                        <label>
                            <div style="align-content: center">Поиск свободного номера на дату</div>
                            <label for="findFreeRoomsStartDate" style="font-weight: normal">Дата заселения :
                                <input id="findFreeRoomsStartDate" name="startDate" type="date" value="2017-01-01"
                                       class="form-control" style="width: 285px; font-size: 14px;">
                            </label>
                            <label for="findFreeRoomsEndDate" style="font-weight: normal">Дата выселения :
                                <input id="findFreeRoomsEndDate" name="endDate" type="date" value="2017-01-01"
                                       class="form-control" style="width: 285px; font-size: 14px;">
                            </label>
                            <button id='findFreeRoomsByDate' type="submit" class="beautyButton" style='cursor: pointer;margin-left: 5px;'>Найти</button>
                        </label>
                    <hr>
                    <table class="table" id="roomsTable">
                        <thead>
                        <tr>
                            <th>Описание</th>
                            <th>Класс номера</th>
                            <th>Количество мест</th>
                            <th>Холодильник</th>
                            <th>Минибар</th>
                            <th>Телевизор</th>
                            <th>Вид на сад</th>
                            <th>Вид на горы</th>
                            <th>Вид на море</th>
                            <th>Цена за ночь на одного, ₽ (без опций)</th>
                            <th>Действие</th>
                        </tr>
                        </thead>
                        <tbody id="roomsTableBody">
                        </tbody>
                    </table>
                </div>
                <div class='modal-footer'>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='freeRoomsModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Свободные Номера</h1>
                </div>
                <div class='modal-body'>
                    <table class="table" id="freeRoomsTable">
                        <thead>
                        <tr>
                            <th>Описание</th>
                            <th>Класс номера</th>
                            <th>Количество мест</th>
                            <th>Холодильник</th>
                            <th>Минибар</th>
                            <th>Телевизор</th>
                            <th>Вид на сад</th>
                            <th>Вид на горы</th>
                            <th>Вид на море</th>
                            <th>Цена за ночь ₽ (без опций)</th>
                            <th>Действие</th>
                        </tr>
                        </thead>
                        <tbody id="freeRoomsTableBody">
                        </tbody>
                    </table>
                </div>
                <div class='modal-footer'>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='busyRoomsModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Занятые Номера</h1>
                </div>
                <div class='modal-body'>
                    <table class="table" id="busyRoomsTable">
                        <thead>
                        <tr>
                            <th>Описание</th>
                            <th>Класс номера</th>
                            <th>Количество мест</th>
                            <th>Холодильник</th>
                            <th>Минибар</th>
                            <th>Телевизор</th>
                            <th>Вид на сад</th>
                            <th>Вид на горы</th>
                            <th>Вид на море</th>
                            <th>Цена за ночь ₽ (без опций)</th>
                            <th>Действие</th>
                        </tr>
                        </thead>
                        <tbody id="busyRoomsTableBody">
                        </tbody>
                    </table>
                </div>
                <div class='modal-footer'>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='reservationsModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Брони</h1>
                </div>
                <div class='modal-body'>
                    <table class="table" id="reservationsTable">
                        <thead>
                        <tr>
                            <th>Описание</th>
                            <th>Класс номера</th>
                            <th>Количество мест</th>
                            <th>Холодильник</th>
                            <th>Минибар</th>
                            <th>Телевизор</th>
                            <th>Вид на сад</th>
                            <th>Вид на горы</th>
                            <th>Вид на море</th>
                            <th>Общая стоимость пребывания ₽</th>
                            <th>ФИО</th>
                            <th>Даты пребывания</th>
                        </tr>
                        </thead>
                        <tbody id="reservationsTableBody">
                        </tbody>
                    </table>
                </div>
                <div class='modal-footer'>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='accommodationInfoModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Информация о проживании</h1>
                </div>
                <div class='modal-body'>
                    <table class="table" id="accommodationInfoTable">
                        <thead>
                        <tr>
                            <th>Описание</th>
                            <th>Класс номера</th>
                            <th>Количество мест</th>
                            <th>Холодильник</th>
                            <th>Минибар</th>
                            <th>Телевизор</th>
                            <th>Вид на сад</th>
                            <th>Вид на горы</th>
                            <th>Вид на море</th>
                            <th>Дополнительные опции</th>
                            <th>Общая стоимость пребывания ₽</th>
                            <th>ФИО</th>
                            <th>Серия и номер паспорта</th>
                            <th>Дата рождения</th>
                            <th>Адрес</th>
                            <th>Даты пребывания</th>
                        </tr>
                        </thead>
                        <tbody id="accommodationInfoTableBody">
                        </tbody>
                    </table>
                </div>
                <div class='modal-footer'>
                </div>
            </div>
        </div>
    </div>
    <div class='modal fade' id='reserveRoomModalWindow' tabindex='-1' role='dialog' aria-hidden='true'>
        <div class='modal-dialog modal-xlg' style='width: 1200px'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h1>Бронирование Номера</h1>
                </div>
                <div class='modal-body'>
                    <div id="reserveRoomDiv">
                        <label for="reserveRoomDate" style="font-weight: normal">Выберите даты бронирования :
                            <input id="reserveRoomDate" name="reserveRoomDate" type="text" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <hr>
                        <div id="reserveClientDiv">

                        </div>
                        <hr>
                        <h2>Опции для групп</h2>
                        <label for="groupId" style="font-weight: normal">ID группы :
                            <input id="groupId" name="groupId" type="text" value="" placeholder="Введите ID группы или получите новый" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <button id='getGroupId' type="submit" class="beautyButton"
                                style='cursor: pointer;margin-left: 5px;'>Получить ID новой группы
                        </button>
                        <label for="groupCountOfClients" style="font-weight: normal">Общее число человек :
                            <input id="groupCountOfClients" name="groupCountOfClients" type="number" step="1" min="0" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <label for="groupDescription" style="font-weight: normal">Описание :
                            <input id="groupDescription" name="groupDescription" type="text" placeholder="Необязательные комментарии" value="" class="form-control"
                                   style="width: 1100px; font-size: 12px;">
                        </label>
                        <hr>
                        <div id="getRoomTotalCostDiv">
                            <button id='getRoomTotalCost' type="submit" class="beautyButton"
                                    style='cursor: pointer;margin-left: 5px;'>Рассчитать стоимость
                            </button>
                        </div>
                    </div>
                </div>
                <div class='modal-footer'>
                    <button id='reserveRoom' type="submit" class="beautyButton"
                            style='cursor: pointer;margin-left: 5px;'>Забронировать
                    </button>
                </div>
            </div>
        </div>
    </div>
    <button id='reservations' type='submit' class='beautyButton' style='cursor: pointer;margin-left: 5px;'>Брони</button>
    <br>
    <button id='busyRooms' type='submit' class='beautyButton' style='cursor: pointer;margin-left: 5px;'>Занятые сейчас номера</button>
    <br>
    <button id='freeRooms' type='submit' class='beautyButton' style='cursor: pointer;margin-left: 5px;'>Свободные сейчас номера</button>
    <br>
    <button id='accommodationInfo' type='submit' class='beautyButton' style='cursor: pointer;margin-left: 5px;'>Информация о проживании</button>
    <br>
    <button id='rooms' type='submit' class='beautyButton' style='cursor: pointer;margin-left: 5px;'>Номера</button>
    <br>
    <button id='employees' type='submit' class='beautyButton' style='cursor: pointer;margin-left: 5px;'>Сотрудники
    </button>
</div>
</body>

<script src="/js/moment.min.js"></script>
<script src="/js/daterangepicker.js"></script>
<script src="/js/auth.js"></script>

</html>
<script>

    $(function () {

        sendRequest('post', '/hotel_auth/check', null, function (response) {
           if (response.success) {
               console.log("Auth success");
           } else {
               console.log("Auth failed");
           }
        });

        function getEmployeesList() {
            sendRequest('post', '/hotel/admin/employees_list', null, function (response) {
                if (response.success) {
                    response.result.map(employee => {
                        var tr = $('<tr>');
                        tr.append('<td>' + employee.username + '</td>');
                        tr.append('<td>' + employee.lastName + '</td>');
                        tr.append('<td>' + employee.firstName + '</td>');
                        tr.append('<td>' + employee.surName + '</td>');
                        tr.append('<td>' + employee.birthDate + '</td>');
                        tr.append('<td>' + employee.seriesNumberPassport + '</td>');
                        tr.append('<td>' + employee.address + '</td>');
                        tr.append('<td>' + employee.salary + '</td>');
                        tr.append("<td><button class='deleteEmployee' employeeUserName='" + employee.username + "' style='cursor: pointer;margin-left: 5px;'>Удалить</button></td>");
                        $('#tableForEmployeesBody').append(tr);
                    });
                    $(".deleteEmployee").on("click",function () {
                        sendRequest('post', '/hotel/admin/delete_employee', JSON.stringify({ "userName": $(this).attr("employeeUserName")}), function (response) {
                            if (response.success) {
                                $('#tableForEmployeesBody').remove();
                                $('#tableForEmployees').append("<tbody id='tableForEmployeesBody' />");
                                getEmployeesList();
                            } else {
                                alert("Error deleting");
                            }
                        });
                    });
                } else {
                    alert("Nothing found");
                }
            });
        }

        $("#addEmployeeInModal").on("click", function () {
            $('#addEmployeeForm').submit(function (e) {
                var object = {};
                (new FormData($(this)[0])).forEach(function(value, key){
                    object[key] = value;
                });
                var json = JSON.stringify(object);
                sendRequest($(this).attr('method'), $(this).attr('action'), json, function (response) {
                    if (response.success) {
                        $('#tableForEmployeesBody').remove();
                        $('#tableForEmployees').append("<tbody id='tableForEmployeesBody' />");
                        getEmployeesList();
                    } else {
                        alert("FAIL!\n" + response.error.description)
                    }
                });
                e.preventDefault();
                return false;
            })
        });

        function getReservationsList() {
            sendRequest('post', '/hotel/admin/reservations_list', null, function (response) {
                if (response.success) {
                    $('#reservationsTableBody').html("");
                    response.result.map(reservedRoom => {
                        var fridge, miniBar, tv, gardenView, mountainView, seaView;
                        if (reservedRoom.options.fridge) {
                            fridge = "Да"
                        } else {
                            fridge = "Нет"
                        }
                        if (reservedRoom.options.miniBar) {
                            miniBar = "Да"
                        } else {
                            miniBar = "Нет"
                        }
                        if (reservedRoom.options.tv) {
                            tv = "Да"
                        } else {
                            tv = "Нет"
                        }
                        if (reservedRoom.options.gardenView) {
                            gardenView = "Да"
                        } else {
                            gardenView = "Нет"
                        }
                        if (reservedRoom.options.mountainView) {
                            mountainView = "Да"
                        } else {
                            mountainView = "Нет"
                        }
                        if (reservedRoom.options.fridge) {
                            seaView = "Да"
                        } else {
                            seaView = "Нет"
                        }
                        var tr = $('<tr>');
                        tr.append('<td>' + reservedRoom.description + '</td>');
                        tr.append('<td>' + reservedRoom.class + '</td>');
                        tr.append('<td>' + reservedRoom.seatsNumber + '</td>');
                        tr.append('<td>' + fridge + '</td>');
                        tr.append('<td>' + miniBar + '</td>');
                        tr.append('<td>' + tv + '</td>');
                        tr.append('<td>' + gardenView + '</td>');
                        tr.append('<td>' + mountainView + '</td>');
                        tr.append('<td>' + seaView + '</td>');
                        tr.append('<td>' + reservedRoom.totalCost + '</td>');
                        tr.append('<td>' + reservedRoom.fio + '</td>');
                        tr.append(
                            '<td>' +
                            '<table class="table">' +
                            '    <thead>\n' +
                            '    <tr>\n' +
                            '        <th>Дата заселения</th>\n' +
                            '        <th>Дата выселения</th>\n' +
                            '    </tr>\n' +
                            '    </thead>\n' +
                            '    <tbody>\n' +
                            '    <tr>\n' +
                            '       <td>' + reservedRoom.checkInDate + '</td>\n' +
                            '       <td>' + reservedRoom.checkOutDate + '</td>\n' +
                            '    </tr>\n' +
                            '    </tbody>\n' +
                            '</table>' +
                            '</td>');
                        $('#reservationsTableBody').append(tr);
                    });
                } else {
                    alert("Nothing found");
                }
            });
        };

        function getAccommodationInfoList() {
            sendRequest('post', '/hotel/admin/accommodation_info_list', null, function (response) {
                if (response.success) {
                    $('#accommodationInfoTableBody').html("");
                    response.result.map(reservedRoom => {
                        var fridge, miniBar, tv, gardenView, mountainView, seaView;
                        if (reservedRoom.options.fridge) {
                            fridge = "Да"
                        } else {
                            fridge = "Нет"
                        }
                        if (reservedRoom.options.miniBar) {
                            miniBar = "Да"
                        } else {
                            miniBar = "Нет"
                        }
                        if (reservedRoom.options.tv) {
                            tv = "Да"
                        } else {
                            tv = "Нет"
                        }
                        if (reservedRoom.options.gardenView) {
                            gardenView = "Да"
                        } else {
                            gardenView = "Нет"
                        }
                        if (reservedRoom.options.mountainView) {
                            mountainView = "Да"
                        } else {
                            mountainView = "Нет"
                        }
                        if (reservedRoom.options.fridge) {
                            seaView = "Да"
                        } else {
                            seaView = "Нет"
                        }
                        var tr = $('<tr>');
                        tr.append('<td>' + reservedRoom.description + '</td>');
                        tr.append('<td>' + reservedRoom.class + '</td>');
                        tr.append('<td>' + reservedRoom.seatsNumber + '</td>');
                        tr.append('<td>' + fridge + '</td>');
                        tr.append('<td>' + miniBar + '</td>');
                        tr.append('<td>' + tv + '</td>');
                        tr.append('<td>' + gardenView + '</td>');
                        tr.append('<td>' + mountainView + '</td>');
                        tr.append('<td>' + seaView + '</td>');
                        tr.append('<td>' + reservedRoom.extraOptions + '</td>');
                        tr.append('<td>' + reservedRoom.totalCost + '</td>');
                        tr.append('<td>' + reservedRoom.fio + '</td>');
                        tr.append('<td>' + reservedRoom.seriesNumberPassport + '</td>');
                        tr.append('<td>' + reservedRoom.birthDate + '</td>');
                        tr.append('<td>' + reservedRoom.address + '</td>');
                        tr.append(
                            '<td>' +
                            '<table class="table">' +
                            '    <thead>\n' +
                            '    <tr>\n' +
                            '        <th>Дата заселения</th>\n' +
                            '        <th>Дата выселения</th>\n' +
                            '    </tr>\n' +
                            '    </thead>\n' +
                            '    <tbody>\n' +
                            '    <tr>\n' +
                            '       <td>' + reservedRoom.checkInDate + '</td>\n' +
                            '       <td>' + reservedRoom.checkOutDate + '</td>\n' +
                            '    </tr>\n' +
                            '    </tbody>\n' +
                            '</table>' +
                            '</td>');
                        $('#accommodationInfoTableBody').append(tr);
                    });
                } else {
                    alert("Nothing found");
                }
            });
        };

        var rooms = {};
        var currentRoom;

        function fillRooms(response, table) {
            response.result.map(room => {
                rooms[room._id] = room;
                var fridge, miniBar, tv, gardenView, mountainView, seaView;
                if (room.options.fridge) {
                    fridge = "Да"
                } else {
                    fridge = "Нет"
                }
                if (room.options.miniBar) {
                    miniBar = "Да"
                } else {
                    miniBar = "Нет"
                }
                if (room.options.tv) {
                    tv = "Да"
                } else {
                    tv = "Нет"
                }
                if (room.options.gardenView) {
                    gardenView = "Да"
                } else {
                    gardenView = "Нет"
                }
                if (room.options.mountainView) {
                    mountainView = "Да"
                } else {
                    mountainView = "Нет"
                }
                if (room.options.fridge) {
                    seaView = "Да"
                } else {
                    seaView = "Нет"
                }
                var tr = $('<tr>');
                tr.append('<td>' + room.description + '</td>');
                tr.append('<td>' + room.class + '</td>');
                tr.append('<td>' + room.seatsNumber + '</td>');
                tr.append('<td>' + fridge + '</td>');
                tr.append('<td>' + miniBar + '</td>');
                tr.append('<td>' + tv + '</td>');
                tr.append('<td>' + gardenView + '</td>');
                tr.append('<td>' + mountainView + '</td>');
                tr.append('<td>' + seaView + '</td>');
                tr.append('<td>' + room.defaultCostPerNight + '</td>');
                tr.append("<td><button class='openReserveDialog' roomId='" + room._id + "' style='cursor: pointer;margin-left: 5px;'>Забронировать</button></td>");
                table.append(tr);
            });
            $(".openReserveDialog").on('click', function () {
                $('#reserveRoomModalWindow').modal('show');
                var clientDiv = $('#reserveClientDiv');
                clientDiv.html("");
                var roomId = $(this).attr("roomId");
                currentRoom = rooms[roomId];
                var invalidDates = currentRoom.reservations.map( function(reservation) {
                    var checkInDate = reservation.checkInDate;
                    var checkOutDate = reservation.checkOutDate;
                    return (checkInDate + ":" + checkOutDate).toString();
                });
                $('#reserveRoomDate').daterangepicker({
                    isInvalidDate: function(date)
                    {
                        var res = false;
                        invalidDates.every( function(invalidDate) {
                            var invalidStartAndEndDates = invalidDate.split(":");
                            var invalidStartDate = moment(invalidStartAndEndDates[0]);
                            var invalidEndDate = moment(invalidStartAndEndDates[1]);
                            if (date >= invalidStartDate && date <= invalidEndDate) {
                                res = true;
                                return false;
                            } else {
                                return true;
                            }
                        });
                        return  res;
                    },
                    locale: {
                        format: 'YYYY-MM-DD'
                    }
                });
                var seatsNumber = currentRoom.seatsNumber
                var i;
                for (i = 0; i < seatsNumber; i++) {
                    clientDiv.append('<label for="clientLastName" style="font-weight: normal">Фамилия :\n' +
                        '                        <input id="clientLastName' + i + '" name="clientLastName" type="text" value="" class="form-control"\n' +
                        '                            style="width: 1100px; font-size: 12px;">\n' +
                        '                                </label>\n' +
                        '                                <br>');
                    clientDiv.append('<label for="clientFirstName" style="font-weight: normal">Имя :\n' +
                        '                <input id="clientFirstName' + i + '" name="clientFirstName" type="text" value="" class="form-control"\n' +
                        '                    style="width: 1100px; font-size: 12px;">\n' +
                        '                        </label>\n' +
                        '                        <br>');
                    clientDiv.append('<label for="clientSurName" style="font-weight: normal">Отчество :\n' +
                        '                <input id="clientSurName' + i + '" name="clientSurName" type="text" value="" class="form-control"\n' +
                        '                    style="width: 1100px; font-size: 12px;">\n' +
                        '                        </label>\n' +
                        '                        <br>');
                    clientDiv.append('<label for="clientBirthDate" style="font-weight: normal">Дата рождения :\n' +
                        '                <input id="clientBirthDate' + i + '" name="clientBirthDate" type="date" value="1970-01-01" class="form-control"\n' +
                        '                     style="width: 1100px; font-size: 12px;">\n' +
                        '                        </label>\n' +
                        '                        <br>');
                    clientDiv.append('<label for="clientSeriesNumberPassport" style="font-weight: normal">Серия и номер паспорта :\n' +
                        '                <input id="clientSeriesNumberPassport' + i + '" name="clientSeriesNumberPassport" type="text" value="" class="form-control"\n' +
                        '                     style="width: 1100px; font-size: 12px;">\n' +
                        '                         </label>\n' +
                        '                         <br>');
                    clientDiv.append('<label for="clientAddress" style="font-weight: normal">Адрес :\n' +
                        '                <input id="clientAddress' + i + '" name="clientAddress" type="text" value="" class="form-control"\n' +
                        '                     style="width: 1100px; font-size: 12px;">\n' +
                        '                         </label>\n' +
                        '                         <hr>');
                }
                clientDiv.append('<div style="align-content: center">Дополнителные опции</div><br>');

                clientDiv.append('<label for="extraBed" style="font-weight: normal;margin-left: 10px;">\n' +
                    '                           <input id="extraBed" name="extraBed" type="checkbox" style="margin-right: 5px;">Дополнительная кровать\n' +
                    '                           </label>');
                clientDiv.append('<label for="bedBreakfast" style="font-weight: normal;margin-left: 10px;">\n' +
                    '                           <input id="bedBreakfast" name="bedBreakfast" type="checkbox" style="margin-right: 5px;">Завтрак\n' +
                    '                           </label>');
                clientDiv.append('<label for="allInclusive" style="font-weight: normal;margin-left: 10px;">\n' +
                    '                           <input id="allInclusive" name="allInclusive" type="checkbox" style="margin-right: 5px;">Все включено\n' +
                    '                           </label>');
                $('#extraBed').click(function() {
                    if ($(this).is(':checked')) {
                        var divForExtraBed = $('<div id="divForExtraBed">');
                        divForExtraBed.append('<label for="clientLastName" style="font-weight: normal">Фамилия :\n' +
                            '                        <input id="clientLastName' + seatsNumber + '" name="clientLastName" type="text" value="" class="form-control"\n' +
                            '                            style="width: 1100px; font-size: 12px;">\n' +
                            '                                </label>\n' +
                            '                                <br>');
                        divForExtraBed.append('<label for="clientFirstName" style="font-weight: normal">Имя :\n' +
                            '                <input id="clientFirstName' + seatsNumber + '" name="clientFirstName" type="text" value="" class="form-control"\n' +
                            '                    style="width: 1100px; font-size: 12px;">\n' +
                            '                        </label>\n' +
                            '                        <br>');
                        divForExtraBed.append('<label for="clientSurName" style="font-weight: normal">Отчество :\n' +
                            '                <input id="clientSurName' + seatsNumber + '" name="clientSurName" type="text" value="" class="form-control"\n' +
                            '                    style="width: 1100px; font-size: 12px;">\n' +
                            '                        </label>\n' +
                            '                        <br>');
                        divForExtraBed.append('<label for="clientBirthDate" style="font-weight: normal">Дата рождения :\n' +
                            '                <input id="clientBirthDate' + seatsNumber + '" name="clientBirthDate" type="date" value="1970-01-01" class="form-control"\n' +
                            '                     style="width: 1100px; font-size: 12px;">\n' +
                            '                        </label>\n' +
                            '                        <br>');
                        divForExtraBed.append('<label for="clientSeriesNumberPassport" style="font-weight: normal">Серия и номер паспорта :\n' +
                            '                <input id="clientSeriesNumberPassport' + seatsNumber + '" name="clientSeriesNumberPassport" type="text" value="" class="form-control"\n' +
                            '                     style="width: 1100px; font-size: 12px;">\n' +
                            '                         </label>\n' +
                            '                         <br>');
                        divForExtraBed.append('<label for="clientAddress" style="font-weight: normal">Адрес :\n' +
                            '                <input id="clientAddress' + seatsNumber + '" name="clientAddress" type="text" value="" class="form-control"\n' +
                            '                     style="width: 1100px; font-size: 12px;">\n' +
                            '                         </label>\n' +
                            '                         <hr>');
                        clientDiv.append(divForExtraBed);
                    } else {
                        document.getElementById("divForExtraBed").remove();
                    }
                });
                $('#bedBreakfast').click(function() {
                    if ($(this).is(':checked')) {
                        document.getElementById("allInclusive").disabled = true;
                    } else {
                        document.getElementById("allInclusive").disabled = false;
                    }
                });
                $('#allInclusive').click(function() {
                    if ($(this).is(':checked')) {
                        document.getElementById("bedBreakfast").disabled = true;
                    } else {
                        document.getElementById("bedBreakfast").disabled = false;
                    }
                });
            });
        };

        function getRoomsList() {
            sendRequest('post', '/hotel/admin/rooms_list', null, function (response) {
                if (response.success) {
                    $('#roomsTableBody').html("");
                    fillRooms(response, $('#roomsTableBody'));
                } else {
                    alert("Nothing found");
                }
            });
        };

        function getBusyRoomsList() {
            sendRequest('post', '/hotel/admin/busy_rooms_list', null, function (response) {
                if (response.success) {
                    $('#busyRoomsTableBody').html("");
                    fillRooms(response, $('#busyRoomsTableBody'));
                } else {
                    alert("Nothing found");
                }
            });
        }

        function getFreeRoomsList() {
            sendRequest('post', '/hotel/admin/free_rooms_list', null, function (response) {
                if (response.success) {
                    $('#freeRoomsTableBody').html("");
                    fillRooms(response, $('#freeRoomsTableBody'));
                } else {
                    alert("Nothing found");
                }
            });
        };

        function getFilteredByDateRoomList() {
            sendRequest('post', '/hotel/admin/filtered_rooms_list', JSON.stringify({
                "checkInDate": document.getElementById("findFreeRoomsStartDate").value,
                "checkOutDate": document.getElementById("findFreeRoomsEndDate").value
            }), function (response) {
                if (response.success) {
                    $('#roomsTableBody').html("");
                    fillRooms(response, $('#roomsTableBody'));
                } else {
                    alert("Nothing found");
                }
            });
        };

        function getGroupId() {
            sendRequest('post', '/hotel/admin/new_group_id', null, function (response) {
                if (response.success) {
                    $("#groupId").val(response.result.groupId);
                } else {
                    alert("FAIL!")
                }
            });
        };

        function getRoomTotalCost() {
            var date = $('#reserveRoomDate').val().split(" - ");
            var jsonDataForReservation = {
                "roomId": currentRoom._id,
                "groupId": $("#groupId").val(),
                "groupCountOfClients": $("#groupCountOfClients").val(),
                "groupDescription": $("#groupDescription").val(),
                "checkInDate": date[0],
                "checkOutDate": date[1],
                "reservations": []
            };
            var seatsNumber = currentRoom.seatsNumber
            var i;
            if ($('#extraBed').is(':checked')) {
                seatsNumber = seatsNumber + 1;
            }
            for (i = 0; i < seatsNumber; i++) {
                var extraBed = false;
                if ($('#extraBed').is(':checked') && i === seatsNumber - 1) {
                    extraBed = true;
                }
                var reservation = {
                    "lastName": document.getElementById("clientLastName" + i).value,
                    "firstName": document.getElementById("clientFirstName" + i).value,
                    "surName": document.getElementById("clientSurName" + i).value,
                    "birthDate": document.getElementById("clientBirthDate" + i).value,
                    "seriesNumberPassport": document.getElementById("clientSeriesNumberPassport" + i).value,
                    "address": document.getElementById("clientAddress" + i).value,
                    "bedBreakfast": $('#bedBreakfast').is(':checked'),
                    "allInclusive": $('#allInclusive').is(':checked'),
                    "extraBed": extraBed
                }
                jsonDataForReservation.reservations.push(reservation);
            }
            sendRequest('post', '/hotel/admin/calculate_room_cost', JSON.stringify(jsonDataForReservation), function (response) {
                if (response.success) {
                    if (document.getElementById("totalCost") != null) {
                        document.getElementById("totalCost").remove();
                    }
                    var pTotalCost = $('<p id="totalCost">');
                    pTotalCost.append('Полная стоимость проживания на даты ' + $('#reserveRoomDate').val() + ' составит: ' + response.result.totalCost + '₽');
                    $("#getRoomTotalCostDiv").append(pTotalCost);
                } else {
                    alert("Ошибка!\n" + response.error.description);
                }
            });
        };

        function getBill() {
            var fridge, miniBar, tv, gardenView, mountainView, seaView;
            var bedBreakfast = "";
            var allInclusive = "";
            var extraBedStr = "";
            var fios = "";
            if (currentRoom.options.fridge) {
                fridge = "Да"
            } else {
                fridge = "Нет"
            }
            if (currentRoom.options.miniBar) {
                miniBar = "Да"
            } else {
                miniBar = "Нет"
            }
            if (currentRoom.options.tv) {
                tv = "Да"
            } else {
                tv = "Нет"
            }
            if (currentRoom.options.gardenView) {
                gardenView = "Да"
            } else {
                gardenView = "Нет"
            }
            if (currentRoom.options.mountainView) {
                mountainView = "Да"
            } else {
                mountainView = "Нет"
            }
            if (currentRoom.options.fridge) {
                seaView = "Да"
            } else {
                seaView = "Нет"
            }

            var date = $('#reserveRoomDate').val().split(" - ");

            var jsonDataForReservation = {
                "roomId": currentRoom._id,
                "groupId": $("#groupId").val(),
                "groupCountOfClients": $("#groupCountOfClients").val(),
                "groupDescription": $("#groupDescription").val(),
                "checkInDate": date[0],
                "checkOutDate": date[1],
                "reservations": []
            };

            var seatsNumber = currentRoom.seatsNumber

            var i;
            var j = 0;
            if ($('#extraBed').is(':checked')) {
                seatsNumber = seatsNumber + 1;
            }
            for (i = 0; i < seatsNumber; i++) {
                var extraBed = false;
                if ($('#extraBed').is(':checked') && i === seatsNumber - 1) {
                    extraBed = true;
                }
                var reservation = {
                    "lastName": document.getElementById("clientLastName" + i).value,
                    "firstName": document.getElementById("clientFirstName" + i).value,
                    "surName": document.getElementById("clientSurName" + i).value,
                    "birthDate": document.getElementById("clientBirthDate" + i).value,
                    "seriesNumberPassport": document.getElementById("clientSeriesNumberPassport" + i).value,
                    "address": document.getElementById("clientAddress" + i).value,
                    "bedBreakfast": $('#bedBreakfast').is(':checked'),
                    "allInclusive": $('#allInclusive').is(':checked'),
                    "extraBed": extraBed
                }
                jsonDataForReservation.reservations.push(reservation);

                if (extraBed) {
                    extraBedStr += " Да"
                } else {
                    extraBedStr += " Нет"
                }
                if ($('#bedBreakfast').is(':checked')) {
                    bedBreakfast += " Да"
                } else {
                    bedBreakfast += " Нет"
                }
                if ($('#allInclusive').is(':checked')) {
                    allInclusive += " Да"
                } else {
                    allInclusive += " Нет"
                }
                if (j === 0) {
                    fios = fios + reservation.lastName + " " + reservation.firstName + " " + reservation.surName;
                } else {
                    fios = fios + ", " + reservation.lastName + " " + reservation.firstName + " " + reservation.surName;
                }
                j += 1;
            }
            function getTotalCost() {
                return
            }

            var totalCost;
            sendRequest('post', '/hotel/admin/calculate_room_cost', JSON.stringify(jsonDataForReservation), function (response) {
                if (response.success) {
                    totalCost = response.result.totalCost;
                } else {
                    alert("Ошибка!\n" + response.error.description);
                }
            });

            var sTable = $('<table class="table">');
            sTable.append('<tr>\n' +
                '                            <th>Описание</th>\n' +
                '                            <th>Класс номера</th>\n' +
                '                            <th>Количество мест</th>\n' +
                '                            <th>Холодильник</th>\n' +
                '                            <th>Минибар</th>\n' +
                '                            <th>Телевизор</th>\n' +
                '                            <th>Вид на сад</th>\n' +
                '                            <th>Вид на горы</th>\n' +
                '                            <th>Вид на море</th>\n' +
                '                            <th>Дополнительные опции</th>\n' +
                '                            <th>Общая стоимость пребывания ₽</th>\n' +
                '                            <th>ФИО</th>\n' +
                '                            <th>Даты пребывания</th>\n' +
                '                        </tr>');
            var tr = $('<tr>');
            tr.append('<td>' + currentRoom.description + '</td>');
            tr.append('<td>' + currentRoom.class + '</td>');
            tr.append('<td>' + currentRoom.seatsNumber + '</td>');
            tr.append('<td>' + fridge + '</td>');
            tr.append('<td>' + miniBar + '</td>');
            tr.append('<td>' + tv + '</td>');
            tr.append('<td>' + gardenView + '</td>');
            tr.append('<td>' + mountainView + '</td>');
            tr.append('<td>' + seaView + '</td>');
            tr.append(
                '<td>' +
                '<table>' +
                '<tr>' +
                '<th>Завтрак</th>' +
                '<th>Все включено</th>' +
                '<th>Доп. кровать</th>' +
                '</tr>' +
                '<tr>' +
                '<td>' + bedBreakfast + '</td>' +
                '<td>' + allInclusive + '</td>' +
                '<td>' + extraBedStr + '</td>' +
                '</tr>' +
                '</table>' +
                '</td>'
            );
            tr.append('<td>' + totalCost + '</td>');
            tr.append('<td>' + fios + '</td>');
            tr.append(
                '<td>' +
                '<table>' +
                '<tr>' +
                '<th>Дата заселения</th>\n' +
                '<th>Дата выселения</th>\n' +
                '</tr>' +
                '<tr>' +
                '<td>' + date[0] + '</td>' +
                '<td>' + date[1] + '</td>' +
                '</tr>' +
                '</table>' +
                '</td>'
            );
            sTable.append(tr);

            var style = "<style>";
            style = style + "table {width: 100%;font: 17px Calibri;}";
            style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
            style = style + "padding: 2px 3px;text-align: center;}";
            style = style + "</style>";

            // CREATE A WINDOW OBJECT.
            var win = window.open('', '', 'height=700,width=700');

            win.document.write('<html><head>');
            win.document.write('<title>Bill</title>');   // <title> FOR PDF HEADER.
            win.document.write(style);          // ADD STYLE INSIDE THE HEAD TAG.
            win.document.write('</head>');
            win.document.write('<body><h1>Счет</h1>');
            win.document.write(sTable[0].outerHTML);         // THE TABLE CONTENTS INSIDE THE BODY TAG.
            win.document.write('</body></html>');

            win.document.close(); 	// CLOSE THE CURRENT WINDOW.

            win.print();    // PRINT THE CONTENTS.
        };

        function reserveRoom() {
            var date = $('#reserveRoomDate').val().split(" - ");
            var jsonDataForReservation = {
                "roomId": currentRoom._id,
                "groupId": $("#groupId").val(),
                "groupCountOfClients": $("#groupCountOfClients").val(),
                "groupDescription": $("#groupDescription").val(),
                "checkInDate": date[0],
                "checkOutDate": date[1],
                "reservations": []
            };
            var seatsNumber = currentRoom.seatsNumber
            var i;
            if ($('#extraBed').is(':checked')) {
                seatsNumber = seatsNumber + 1;
            }
            for (i = 0; i < seatsNumber; i++) {
                var extraBed = false;
                if ($('#extraBed').is(':checked') && i === seatsNumber - 1) {
                    extraBed = true;
                }
                var reservation = {};
                if (document.getElementById("clientLastName" + i).value === "" || document.getElementById("clientFirstName" + i).value === "") {
                    reservation = jsonDataForReservation.reservations[jsonDataForReservation.reservations.length - 1]
                } else if (document.getElementById("clientSeriesNumberPassport" + i).value === "" || document.getElementById("clientAddress" + i).value === "") {
                    alert("Fail!\nNot all data was added");
                } else {
                    reservation = {
                        "lastName": document.getElementById("clientLastName" + i).value,
                        "firstName": document.getElementById("clientFirstName" + i).value,
                        "surName": document.getElementById("clientSurName" + i).value,
                        "birthDate": document.getElementById("clientBirthDate" + i).value,
                        "seriesNumberPassport": document.getElementById("clientSeriesNumberPassport" + i).value,
                        "address": document.getElementById("clientAddress" + i).value,
                        "bedBreakfast": $('#bedBreakfast').is(':checked'),
                        "allInclusive": $('#allInclusive').is(':checked'),
                        "extraBed": extraBed
                    }
                }
                jsonDataForReservation.reservations.push(reservation);
            }
            sendRequest('post', '/hotel/admin/reserve_room', JSON.stringify(jsonDataForReservation), function (response) {
                if (response.success) {
                    alert("Номер успешно забранирован!");
                    getBill();
                    rooms = {};
                    currentRoom = null;
                    $('#roomsTableBody').remove();
                    $('#roomsTable').append("<tbody id='roomsTableBody' />");
                    getRoomsList();
                } else {
                    alert("Ошибка!\n" + response.error.description);
                }
            });
        };

        $("#employees").on("click", function () {
            $('#employeesModalWindow').modal('show');
            $('#tableForEmployeesBody').remove();
            $('#tableForEmployees').append("<tbody id='tableForEmployeesBody' />");
            getEmployeesList();
        });

        $("#addEmployee").on("click", function () {
            $('#addEmployeeModalWindow').modal('show');
        });

        $("#rooms").on("click", function () {
            rooms = {};
            currentRoom = null;
            $('#roomsModalWindow').modal('show');
            $('#roomsTableBody').remove();
            $('#roomsTable').append("<tbody id='roomsTableBody' />");
            getRoomsList();
        });

        $("#busyRooms").on("click", function () {
            rooms = {};
            currentRoom = null;
            $('#busyRoomsModalWindow').modal('show');
            $('#busyRoomsTableBody').remove();
            $('#busyRoomsTable').append("<tbody id='busyRoomsTableBody' />");
            getBusyRoomsList();
        });

        $("#freeRooms").on("click", function() {
            rooms = {};
            currentRoom = null;
            $('#freeRoomsModalWindow').modal('show');
            $('#freeRoomsTableBody').remove();
            $('#freeRoomsTable').append("<tbody id='freeRoomsTableBody' />");
            getFreeRoomsList();
        });

        $("#findFreeRoomsByDate").on("click", function () {
            $('#reserveClientDiv').html("");
            rooms = {};
            currentRoom = null;
            getFilteredByDateRoomList();
        });

        $("#reservations").on("click", function () {
            $('#reservationsModalWindow').modal('show');
            $('#reservationsTableBody').remove();
            $('#reservationsTable').append("<tbody id='reservationsTableBody' />");
           getReservationsList();
        });

        $("#accommodationInfo").on("click", function () {
            $('#accommodationInfoModalWindow').modal('show');
            $('#accommodationInfoTableBody').remove();
            $('#accommodationInfoTable').append("<tbody id='accommodationInfoTableBody' />");
            getAccommodationInfoList();
        });

        $("#getGroupId").on("click", function () {
           getGroupId();
        });

        $("#getRoomTotalCost").on("click", function() {
            getRoomTotalCost();
        });

        $("#reserveRoom").on("click", function() {
            reserveRoom();
        });
    });
</script>
